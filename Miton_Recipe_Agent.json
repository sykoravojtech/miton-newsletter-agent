{
  "name": "Miton Recipe Agent",
  "nodes": [
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Z√≠skej recepty, co m√° u≈æivatel r√°d.",
        "memoryKey": {
          "__rl": true,
          "value": "recipes",
          "mode": "list",
          "cachedResultName": "recipes"
        },
        "includeDocumentMetadata": false
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        1340,
        100
      ],
      "id": "e34abc63-080a-418d-acce-d382ceb87bab",
      "name": "oblibene_recepty"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Jsi AI agent v n8n.\n\n√ökol:\n1. N√°hodnƒõ vyber jednu kuchyni ze seznamu: {{ $json.preferovaneKuchyne }}.\n2. Vytvo≈ô recept na obƒõd.\n3. Vyluƒç v≈°echny suroviny uveden√© v seznamu: {{ $json.alergie }}.\n4. Pou≈æ√≠vej pouze metrick√© jednotky (gramy) a uveƒè p≈ôesn√© mno≈æstv√≠ u ka≈æd√© suroviny.\n5. Pokud jsou dostupn√© informace z vector store \"oblibene_recepty\", zohledni je.\n6. V√Ωstup dej jako Markdown text.\n7. V√Ωstup bude obsahovat pouze recept, ≈æ√°dn√© dal≈°√≠ vysvƒõtlov√°n√≠.\n8. Neopakuj recepty. Zkou≈°ej nov√© ale zaveden√©.\n\nP≈ô√≠klad v√Ωstupu:\n\n*Kuchynƒõ:* italsk√°\n\n*N√°zev:* Spaghetti Carbonara\n\n*Ingredience:*\n100 g ≈°paget\n80 g slaniny\n2 vejce (100 g)\n50 g parmez√°nu\n10 g olivov√©ho oleje\n2 g ƒçern√©ho pep≈ôe\n3 g soli\n\n*Postup:*\n1. Uva≈ô ≈°pagety ve slan√© vodƒõ podle n√°vodu na obalu.\n2. Na p√°nvi osmahni nakr√°jenou slaninu dozlatova.\n3. V misce roz≈°lehej vejce s parmez√°nem a pep≈ôem.\n4. Uva≈ôen√© ≈°pagety vm√≠chej do vajeƒçn√© smƒõsi a p≈ôidej slaninu.\n5. Rychle prom√≠chej a ihned pod√°vej.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1140,
        -120
      ],
      "id": "a1ef8911-388a-4b27-ac85-4049ba16042a",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/embedding-001"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        1420,
        300
      ],
      "id": "fd89fb9d-ff52-439e-9253-003afd015fe2",
      "name": "embeddings",
      "credentials": {
        "googlePalmApi": {
          "id": "VFtD7YnCNOrif4xB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('poslouchat_stisk_tlacitka').item.json.callback_query.message.chat.id }}",
        "text": "=üçΩÔ∏è *V√°≈° recept ze dne {{ $now.format('dd-MM-yyyy') }}*\n\n{{ $json.output }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üëç L√≠bilo",
                    "additionalFields": {
                      "callback_data": "libilo"
                    }
                  },
                  {
                    "text": "Nov√Ω recept",
                    "additionalFields": {
                      "callback_data": "novy_recept"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "d25836c2-29df-41e0-a3be-246850f33fd8",
      "name": "odeslat_zpravu_telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1720,
        80
      ],
      "webhookId": "c0074305-ccb7-4e3f-a2d0-68523179f3ec",
      "credentials": {
        "telegramApi": {
          "id": "pUKC7YC9vss0Fu3D",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "callback_query"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        480,
        330
      ],
      "id": "e54e7e21-170d-486d-864c-dd30dedfd464",
      "name": "poslouchat_stisk_tlacitka",
      "webhookId": "f90a2d4d-07ef-4b9f-ac0b-2f04877effc3",
      "credentials": {
        "telegramApi": {
          "id": "pUKC7YC9vss0Fu3D",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "novy_recept",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a3c7ae7b-47be-4d73-a5f5-63b79a3f2f12"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "novy_recept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "41600653-842c-4afd-bab7-af3a95cd1eeb",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "libilo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "libilo"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        700,
        330
      ],
      "id": "7eb97566-ae31-4783-9d05-e98a0e4659aa",
      "name": "rozcesti"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "eddf92db-0b0e-45d6-bff3-959422e6d928",
              "name": "text",
              "value": "={{ $json.callback_query.message.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        920,
        520
      ],
      "id": "cae8079c-759f-4ba1-8d5d-da44fa0ff406",
      "name": "jen_recept"
    },
    {
      "parameters": {
        "mode": "insert",
        "memoryKey": {
          "__rl": true,
          "value": "recipes",
          "mode": "list",
          "cachedResultName": "recipes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        1260,
        520
      ],
      "id": "1606409a-8b2c-4152-8c3c-d2375569d51c",
      "name": "oblibene_recepty_pridani"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        1400,
        740
      ],
      "id": "522ca1bb-d312-4b1d-9347-5510809d9c32",
      "name": "nacitani_dat"
    },
    {
      "parameters": {
        "modelName": "models/embedding-001"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        1280,
        740
      ],
      "id": "43c77c90-7b0e-4f67-b251-b6a2ddcc6e27",
      "name": "embeddings1",
      "credentials": {
        "googlePalmApi": {
          "id": "VFtD7YnCNOrif4xB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "model": "meta-llama/llama-4-maverick-17b-128e-instruct",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [
        1100,
        100
      ],
      "id": "611be6b1-3539-4522-a048-4214b5ee5152",
      "name": "ai_model",
      "credentials": {
        "groqApi": {
          "id": "FPq6u61OmCOhMGVh",
          "name": "Groq account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Zde zaƒç√≠n√° akce\nZde poslouch√°me stisk tlaƒç√≠tek \"L√≠bilo\" a \"Nov√Ω recept\" a pot√© se rozhodujeme co d√°le.\n- V p≈ô√≠padƒõ \"Nov√Ω recept\" jdeme nahoru a z√≠sk√°v√°me novou zpr√°vu s receptem od agenta\n- V p≈ô√≠padƒõ \"L√≠bilo\" jdeme dolu a ukl√°d√°me recept v datab√°zi obl√≠ben√Ωch recept≈Ø",
        "height": 340,
        "width": 500,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        300,
        160
      ],
      "typeVersion": 1,
      "id": "38292f84-0bf1-452c-9fa6-d888a4abe935",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "Zde m≈Ø≈æete zmƒõnit preference kuchyn√≠ a alergi√≠",
        "width": 220,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        800,
        20
      ],
      "typeVersion": 1,
      "id": "a425cf26-999a-4fef-9630-52398680690f",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "Toto je v√°≈° AI Agent. AI Agent m√° 3 souƒç√°sti\n- (Povinn√©) Chat Model: Mozek agenta, velk√Ω jazykov√Ω model (LLM). Ten to cel√© ≈ô√≠d√≠.\n- (nepovinn√©) Memory: Agentovi m≈Ø≈æete p≈ôidat pamƒõ≈•, aby si pamatoval informace z va≈°ich p≈ôedchoz√≠ch chat≈Ø. Nebo v na≈°em p≈ô√≠padƒõ, jsme agentovi ≈ôekli, a≈• neopakuje recepty, co≈æ je mo≈æn√© d√≠ky t√©to pamƒõti.\n- (nepovinn√©) Tool: N√°stroj≈Ø m≈Ø≈æete p≈ôipojit nƒõkolik, a≈• u≈æ je to vyhled√°v√°n√≠ na internetu, p≈ô√≠stup k pos√≠l√°n√≠ a email≈Ø, nebo zapisov√°n√≠ a ƒçten√≠ dokument≈Ø. V na≈°em p≈ô√≠padƒõ je to p≈ô√≠stup do chytr√© vektorov√© datab√°ze obsahuj√≠c√≠ obl√≠ben√© recepty.\n",
        "height": 760,
        "width": 520,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1080,
        -340
      ],
      "typeVersion": 1,
      "id": "f3eed249-7dd3-49a4-ac3f-8fe86600356a",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "Tady odes√≠l√°te v√Ωstup z agenta do Telegramov√©ho chatu",
        "height": 240,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1640,
        0
      ],
      "typeVersion": 1,
      "id": "bbd87331-d7f2-48dd-aa51-f2d97eaf175e",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n\n\n\n\nZde vynd√°me z informac√≠ z telegramu jen text receptu",
        "height": 220,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        780,
        520
      ],
      "typeVersion": 1,
      "id": "29441cfe-362b-4731-addc-cfb60e4701cb",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "Zde se ukl√°d√° obl√≠ben√Ω recept, aby jej agent mohl vyhledat v oblibene_recepty",
        "height": 420,
        "width": 420,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1260,
        440
      ],
      "typeVersion": 1,
      "id": "5995f6ef-8edb-4b22-aacf-f02ae942fbe1",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## √övod chatu\nTento blok je pot≈ôeba spustit jednou na zaƒç√°tku a pot√© u≈æ nen√≠ pot≈ôeba.\n**Zde mus√≠te p≈ô√≠dat _chat.id_ z√≠skan√© bƒõhem nastavov√°n√≠ Telegram bota**\n",
        "height": 300,
        "width": 320
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        320,
        -300
      ],
      "typeVersion": 1,
      "id": "affa2429-17c0-4b77-9a4c-82b5851d2a67",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "chatId": "1892134664",
        "text": "=üë®‚Äçüç≥ V√≠tej u sv√©ho osobn√≠ho kucha≈ôsk√©ho asistenta!\nJsem tu, abych ti pomohl s va≈ôen√≠m na m√≠ru.\n\nüçΩÔ∏è Nov√Ω recept\nTou≈æ√≠≈° po inspiraci? Klikni na ‚ÄûNov√Ω recept‚Äú a p≈ôiprav√≠m nƒõco podle tv√©ho vkusu.\n\nüëç L√≠bilo se mi\nPokud ti nƒõjak√Ω recept chutnal, klikni na ‚ÄûL√≠bilo‚Äú pod n√≠m. Pom≈Ø≈æe mi to trefit se p≈ô√≠≈°tƒõ je≈°tƒõ l√©pe.",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Nov√Ω recept",
                    "additionalFields": {
                      "callback_data": "novy_recept"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "03b0805b-6b3c-458d-849c-2972f2b8ec21",
      "name": "uvodni_zprava",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        380,
        -160
      ],
      "webhookId": "c0074305-ccb7-4e3f-a2d0-68523179f3ec",
      "credentials": {
        "telegramApi": {
          "id": "pUKC7YC9vss0Fu3D",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "002b6ea4-7471-4264-aba2-9c8f7ed86fb1",
              "name": "preferovaneKuchyne",
              "value": "=\"ƒçesk√°, italsk√°\"",
              "type": "string"
            },
            {
              "id": "0a3880fc-7581-4f39-97e1-64fa60a60564",
              "name": "alergie",
              "value": "=bur√°ky",
              "type": "string"
            },
            {
              "id": "b93affd4-b05a-4224-b0b4-f68ce9615ced",
              "name": "=sessionId",
              "value": "={{ $json.callback_query.message.chat.id }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "68287029-3562-4da9-ad99-91f927586614",
      "name": "nastaveni_preferenci",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        920,
        80
      ]
    },
    {
      "parameters": {
        "contextWindowLength": 500
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1220,
        100
      ],
      "id": "b036d21c-d5ef-4915-9b69-500ed6ee4a6a",
      "name": "pamet"
    }
  ],
  "pinData": {},
  "connections": {
    "oblibene_recepty": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "odeslat_zpravu_telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "embeddings": {
      "ai_embedding": [
        [
          {
            "node": "oblibene_recepty",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "poslouchat_stisk_tlacitka": {
      "main": [
        [
          {
            "node": "rozcesti",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rozcesti": {
      "main": [
        [
          {
            "node": "nastaveni_preferenci",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "jen_recept",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "jen_recept": {
      "main": [
        [
          {
            "node": "oblibene_recepty_pridani",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "nacitani_dat": {
      "ai_document": [
        [
          {
            "node": "oblibene_recepty_pridani",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "embeddings1": {
      "ai_embedding": [
        [
          {
            "node": "oblibene_recepty_pridani",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "ai_model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "nastaveni_preferenci": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pamet": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8835cec3-1971-4349-be20-1faac7d64fef",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "da2da4ed9bef6208906d620416fee5b041c6fe3523cc13c53c91b2891ab6d460"
  },
  "id": "W3YkhNgZWlvoKEpB",
  "tags": []
}